// Monthly calender display used for stations to plan shows

import { React, useState, useEffect } from 'react'
import Calendar from 'react-calendar';
import 'react-calendar/dist/Calendar.css';
import dayjs from 'dayjs';

export default function MonthlyCalendar( {stationId} ) {
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [shows, setShows] = useState([]);

  const month = dayjs(selectedDate).format('MM');
  const year = dayjs(selectedDate).format('YYYY');

  useEffect(() => {
    fetch(`http://localhost:5001/shows/monthly?stationId=${stationId}&month=${month}&year=${year}`)
      .then(res => res.json())
      .then(setShows)
      .catch(err => console.error('Fetch error:', err));
  }, [stationId, month, year]);

  return (
    <div>
      <h2>Schedule</h2>
      <Calendar
        value={selectedDate}
        onChange={setSelectedDate}
        tileContent={({ date }) => {
          const dateStr = dayjs(date).format('YYYY-MM-DD');
          const showOnThisDay = shows.filter(show => dayjs(show.startTime).format('YYYY-MM-DD') === dateStr);
          return showOnThisDay.length > 0 ? (
            <div className="calendar-dot" />
          ) : null;
        }}
      />
      <div className="calendar-shows">
        <h3>Shows on {dayjs(selectedDate).format('DD/MM/YYYY')}</h3>
        {shows
          .filter(show => dayjs(show.startTime).format('YYYY-MM-DD') === dayjs(selectedDate).format('YYYY-MM-DD'))
          .map(show => (
            <div key={show.id} className="calendar-show-card">
              <strong>{show.title}</strong> â€” {dayjs(show.startTime).format('HH:mm')} by {show.artistUsername}
              <p>{show.description}</p>
            </div>
          ))}
      </div>
    </div>
  )
}
